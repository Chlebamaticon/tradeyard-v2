import { MigrationInterface, QueryRunner } from "typeorm";

export class UpdatedAggregateEventsFactory1716814836224 implements MigrationInterface {
    name = 'UpdatedAggregateEventsFactory1716814836224'

    public async up(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","user_credential_view","public"]);
        await queryRunner.query(`DROP VIEW "user_credential_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","contract_view","public"]);
        await queryRunner.query(`DROP VIEW "contract_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","contract_deployment_view","public"]);
        await queryRunner.query(`DROP VIEW "contract_deployment_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","offer_view","public"]);
        await queryRunner.query(`DROP VIEW "offer_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","order_view","public"]);
        await queryRunner.query(`DROP VIEW "order_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","token_view","public"]);
        await queryRunner.query(`DROP VIEW "token_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","user_wallet_view","public"]);
        await queryRunner.query(`DROP VIEW "user_wallet_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","complaint_message_view","public"]);
        await queryRunner.query(`DROP VIEW "complaint_message_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","complaint_view","public"]);
        await queryRunner.query(`DROP VIEW "complaint_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","offer_variant_view","public"]);
        await queryRunner.query(`DROP VIEW "offer_variant_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","offer_variant_price_view","public"]);
        await queryRunner.query(`DROP VIEW "offer_variant_price_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","user_view","public"]);
        await queryRunner.query(`DROP VIEW "user_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","moderator_view","public"]);
        await queryRunner.query(`DROP VIEW "moderator_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","merchant_view","public"]);
        await queryRunner.query(`DROP VIEW "merchant_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","customer_view","public"]);
        await queryRunner.query(`DROP VIEW "customer_view"`);
        await queryRunner.query(`CREATE VIEW "contract_deployment_view" AS SELECT ("event"."body" ->> 'contract_id')::uuid AS "contract_id", ("event"."body" ->> 'deployment')::jsonb ->> 'transaction_hash' AS "transaction_hash", ("event"."body" ->> 'deployment')::jsonb ->> 'error' AS "error_message", ("event"."body" ->> 'deployment')::jsonb ->> 'address' AS "address", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'contract_id')::uuid AS "contract_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('contract:deployment:started','contract:deployment:failed','contract:deployment:completed')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'contract_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","contract_deployment_view","SELECT (\"event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", (\"event\".\"body\" ->> 'deployment')::jsonb ->> 'transaction_hash' AS \"transaction_hash\", (\"event\".\"body\" ->> 'deployment')::jsonb ->> 'error' AS \"error_message\", (\"event\".\"body\" ->> 'deployment')::jsonb ->> 'address' AS \"address\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('contract:deployment:started','contract:deployment:failed','contract:deployment:completed')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'contract_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "contract_view" AS SELECT ("event"."body" ->> 'contract_id')::uuid AS "contract_id", "contract_deployment"."address" AS "contract_address", "contract_deployment"."transaction_hash" AS "deployment_transaction_hash", "contract_deployment"."created_at" AS "deployed_at", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'contract_id')::uuid AS "contract_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('contract:created')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'contract_id') "event" LEFT JOIN (SELECT * FROM "contract_deployment_view" "deployment" ORDER BY "deployment"."created_at" DESC) "contract_deployment" ON "contract_deployment"."contract_id" = ("event"."body" ->> 'contract_id')::uuid`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","contract_view","SELECT (\"event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", \"contract_deployment\".\"address\" AS \"contract_address\", \"contract_deployment\".\"transaction_hash\" AS \"deployment_transaction_hash\", \"contract_deployment\".\"created_at\" AS \"deployed_at\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('contract:created')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'contract_id') \"event\" LEFT JOIN (SELECT * FROM \"contract_deployment_view\" \"deployment\" ORDER BY \"deployment\".\"created_at\" DESC) \"contract_deployment\" ON \"contract_deployment\".\"contract_id\" = (\"event\".\"body\" ->> 'contract_id')::uuid"]);
        await queryRunner.query(`CREATE VIEW "merchant_view" AS SELECT ("event"."body" ->> 'merchant_id')::uuid AS "merchant_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'merchant_id')::uuid AS "merchant_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('merchant:created','merchant:updated','merchant:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'merchant_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","merchant_view","SELECT (\"event\".\"body\" ->> 'merchant_id')::uuid AS \"merchant_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'merchant_id')::uuid AS \"merchant_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('merchant:created','merchant:updated','merchant:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'merchant_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "moderator_view" AS SELECT ("event"."body" ->> 'moderator_id')::uuid AS "moderator_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'moderator_id')::uuid AS "moderator_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('moderator:created','moderator:updated','moderator:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'moderator_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","moderator_view","SELECT (\"event\".\"body\" ->> 'moderator_id')::uuid AS \"moderator_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'moderator_id')::uuid AS \"moderator_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('moderator:created','moderator:updated','moderator:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'moderator_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "user_view" AS SELECT ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'first_name')::varchar AS "first_name", ("event"."body" ->> 'last_name')::varchar AS "last_name", ("event"."body" ->> 'email')::varchar AS "email", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'user_id')::uuid AS "user_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('user:created','user:updated','user:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'user_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","user_view","SELECT (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'first_name')::varchar AS \"first_name\", (\"event\".\"body\" ->> 'last_name')::varchar AS \"last_name\", (\"event\".\"body\" ->> 'email')::varchar AS \"email\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('user:created','user:updated','user:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'user_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "customer_view" AS SELECT ("event"."body" ->> 'customer_id')::uuid AS "customer_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'customer_id')::uuid AS "customer_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('customer:created','customer:updated','customer:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'customer_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","customer_view","SELECT (\"event\".\"body\" ->> 'customer_id')::uuid AS \"customer_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'customer_id')::uuid AS \"customer_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('customer:created','customer:updated','customer:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'customer_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "token_view" AS SELECT ("event"."body" ->> 'token_id')::uuid AS "token_id", ("event"."body" ->> 'token_address')::varchar AS "token_address", ("event"."body" ->> 'icon_url')::varchar AS "icon_url", ("event"."body" ->> 'symbol')::varchar AS "symbol", ("event"."body" ->> 'precision')::int AS "precision", ("event"."body" ->> 'name')::varchar AS "name", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'token_id')::uuid AS "token_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('token:created','token:updated','token:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'token_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","token_view","SELECT (\"event\".\"body\" ->> 'token_id')::uuid AS \"token_id\", (\"event\".\"body\" ->> 'token_address')::varchar AS \"token_address\", (\"event\".\"body\" ->> 'icon_url')::varchar AS \"icon_url\", (\"event\".\"body\" ->> 'symbol')::varchar AS \"symbol\", (\"event\".\"body\" ->> 'precision')::int AS \"precision\", (\"event\".\"body\" ->> 'name')::varchar AS \"name\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'token_id')::uuid AS \"token_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('token:created','token:updated','token:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'token_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "offer_variant_price_view" AS SELECT ("event"."body" ->> 'offer_variant_id')::uuid AS "offer_variant_id", ("event"."body" ->> 'offer_variant_price_id')::uuid AS "offer_variant_price_id", ("event"."body" ->> 'token_id')::uuid AS "token_id", "event"."body" ->> 'amount' AS "amount", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'offer_variant_price_id')::uuid AS "offer_variant_price_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('offer:variant:price:created','offer:variant:price:updated','offer:variant:price:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'offer_variant_price_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","offer_variant_price_view","SELECT (\"event\".\"body\" ->> 'offer_variant_id')::uuid AS \"offer_variant_id\", (\"event\".\"body\" ->> 'offer_variant_price_id')::uuid AS \"offer_variant_price_id\", (\"event\".\"body\" ->> 'token_id')::uuid AS \"token_id\", \"event\".\"body\" ->> 'amount' AS \"amount\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'offer_variant_price_id')::uuid AS \"offer_variant_price_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('offer:variant:price:created','offer:variant:price:updated','offer:variant:price:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'offer_variant_price_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "offer_view" AS SELECT ("event"."body" ->> 'offer_id')::uuid AS "offer_id", ("event"."body" ->> 'title') AS "title", ("event"."body" ->> 'description') AS "description", ("event"."body" ->> 'merchant_id')::uuid AS "merchant_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'offer_id')::uuid AS "offer_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('offer:created','offer:updated','offer:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'offer_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","offer_view","SELECT (\"event\".\"body\" ->> 'offer_id')::uuid AS \"offer_id\", (\"event\".\"body\" ->> 'title') AS \"title\", (\"event\".\"body\" ->> 'description') AS \"description\", (\"event\".\"body\" ->> 'merchant_id')::uuid AS \"merchant_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'offer_id')::uuid AS \"offer_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('offer:created','offer:updated','offer:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'offer_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "offer_variant_view" AS SELECT ("event"."body" ->> 'offer_id')::uuid AS "offer_id", ("event"."body" ->> 'offer_variant_id')::uuid AS "offer_variant_id", "event"."body" ->> 'title' AS "title", "event"."body" ->> 'description' AS "description", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'offer_variant_id')::uuid AS "offer_variant_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('offer:variant:created','offer:variant:updated','offer:variant:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'offer_variant_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","offer_variant_view","SELECT (\"event\".\"body\" ->> 'offer_id')::uuid AS \"offer_id\", (\"event\".\"body\" ->> 'offer_variant_id')::uuid AS \"offer_variant_id\", \"event\".\"body\" ->> 'title' AS \"title\", \"event\".\"body\" ->> 'description' AS \"description\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'offer_variant_id')::uuid AS \"offer_variant_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('offer:variant:created','offer:variant:updated','offer:variant:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'offer_variant_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "order_view" AS SELECT ("event"."body" ->> 'order_id')::uuid AS "order_id", ("event"."body" ->> 'offer_variant_id')::uuid AS "offer_variant_id", ("event"."body" ->> 'offer_variant_price_id')::uuid AS "offer_variant_price_id", ("event"."body" ->> 'quantity') AS "quantity", ("event"."body" ->> 'contract_id')::uuid AS "contract_id", ("event"."body" ->> 'merchant_id')::uuid AS "merchant_id", ("event"."body" ->> 'customer_id')::uuid AS "customer_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'order_id')::uuid AS "order_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('order:created','order:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'order_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","order_view","SELECT (\"event\".\"body\" ->> 'order_id')::uuid AS \"order_id\", (\"event\".\"body\" ->> 'offer_variant_id')::uuid AS \"offer_variant_id\", (\"event\".\"body\" ->> 'offer_variant_price_id')::uuid AS \"offer_variant_price_id\", (\"event\".\"body\" ->> 'quantity') AS \"quantity\", (\"event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", (\"event\".\"body\" ->> 'merchant_id')::uuid AS \"merchant_id\", (\"event\".\"body\" ->> 'customer_id')::uuid AS \"customer_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'order_id')::uuid AS \"order_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('order:created','order:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'order_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "complaint_view" AS SELECT ("event"."body" ->> 'complaint_id')::uuid AS "complaint_id", ("event"."body" ->> 'order_id')::uuid AS "order_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'decision')::jsonb AS "decision", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'complaint_id')::uuid AS "complaint_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('complaint:created','complaint:decision:refunded','complaint:decision:rejected','complaint:decision:released')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'complaint_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","complaint_view","SELECT (\"event\".\"body\" ->> 'complaint_id')::uuid AS \"complaint_id\", (\"event\".\"body\" ->> 'order_id')::uuid AS \"order_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'decision')::jsonb AS \"decision\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'complaint_id')::uuid AS \"complaint_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('complaint:created','complaint:decision:refunded','complaint:decision:rejected','complaint:decision:released')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'complaint_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "complaint_message_view" AS SELECT ("event"."body" ->> 'complaint_message_id')::uuid AS "complaint_message_id", ("event"."body" ->> 'complaint_id')::uuid AS "complaint_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'sent_at')::timestamp AS "sent_at", ("event"."body" ->> 'body') AS "body", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'complaint_message_id')::uuid AS "complaint_message_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('complaint:message:created')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'complaint_message_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","complaint_message_view","SELECT (\"event\".\"body\" ->> 'complaint_message_id')::uuid AS \"complaint_message_id\", (\"event\".\"body\" ->> 'complaint_id')::uuid AS \"complaint_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'sent_at')::timestamp AS \"sent_at\", (\"event\".\"body\" ->> 'body') AS \"body\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'complaint_message_id')::uuid AS \"complaint_message_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('complaint:message:created')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'complaint_message_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "user_wallet_view" AS SELECT ("event"."body" ->> 'user_wallet_id')::uuid AS "user_wallet_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'chain')::varchar AS "chain", ("event"."body" ->> 'address')::varchar AS "address", ("event"."body" ->> 'type')::varchar AS "type", ("event"."body" ->> 'sub_organization_id')::varchar AS "sub_organization_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'user_wallet_id')::uuid AS "user_wallet_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('user:wallet:created')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'user_wallet_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","user_wallet_view","SELECT (\"event\".\"body\" ->> 'user_wallet_id')::uuid AS \"user_wallet_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'chain')::varchar AS \"chain\", (\"event\".\"body\" ->> 'address')::varchar AS \"address\", (\"event\".\"body\" ->> 'type')::varchar AS \"type\", (\"event\".\"body\" ->> 'sub_organization_id')::varchar AS \"sub_organization_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'user_wallet_id')::uuid AS \"user_wallet_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('user:wallet:created')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'user_wallet_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "user_credential_view" AS SELECT ("event"."body" ->> 'user_credential_id')::uuid AS "user_credential_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'type')::varchar AS "type", ("event"."body" ->> 'hash')::varchar AS "hash", ("event"."body" ->> 'salt')::varchar AS "salt", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'user_credential_id')::uuid AS "user_credential_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM (SELECT * FROM "events" "event" WHERE ("event"."type" IN ('user:credential:created','user:credential:snapshot')) ORDER BY id ASC) "inner_event" GROUP BY "inner_event"."body" ->> 'user_credential_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","user_credential_view","SELECT (\"event\".\"body\" ->> 'user_credential_id')::uuid AS \"user_credential_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'type')::varchar AS \"type\", (\"event\".\"body\" ->> 'hash')::varchar AS \"hash\", (\"event\".\"body\" ->> 'salt')::varchar AS \"salt\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'user_credential_id')::uuid AS \"user_credential_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM (SELECT * FROM \"events\" \"event\" WHERE (\"event\".\"type\" IN ('user:credential:created','user:credential:snapshot')) ORDER BY id ASC) \"inner_event\" GROUP BY \"inner_event\".\"body\" ->> 'user_credential_id') \"event\""]);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","user_credential_view","public"]);
        await queryRunner.query(`DROP VIEW "user_credential_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","user_wallet_view","public"]);
        await queryRunner.query(`DROP VIEW "user_wallet_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","complaint_message_view","public"]);
        await queryRunner.query(`DROP VIEW "complaint_message_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","complaint_view","public"]);
        await queryRunner.query(`DROP VIEW "complaint_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","order_view","public"]);
        await queryRunner.query(`DROP VIEW "order_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","offer_variant_view","public"]);
        await queryRunner.query(`DROP VIEW "offer_variant_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","offer_view","public"]);
        await queryRunner.query(`DROP VIEW "offer_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","offer_variant_price_view","public"]);
        await queryRunner.query(`DROP VIEW "offer_variant_price_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","token_view","public"]);
        await queryRunner.query(`DROP VIEW "token_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","customer_view","public"]);
        await queryRunner.query(`DROP VIEW "customer_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","user_view","public"]);
        await queryRunner.query(`DROP VIEW "user_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","moderator_view","public"]);
        await queryRunner.query(`DROP VIEW "moderator_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","merchant_view","public"]);
        await queryRunner.query(`DROP VIEW "merchant_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","contract_view","public"]);
        await queryRunner.query(`DROP VIEW "contract_view"`);
        await queryRunner.query(`DELETE FROM "typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","contract_deployment_view","public"]);
        await queryRunner.query(`DROP VIEW "contract_deployment_view"`);
        await queryRunner.query(`CREATE VIEW "customer_view" AS SELECT ("event"."body" ->> 'customer_id')::uuid AS "customer_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'customer_id')::uuid AS "customer_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('customer:created','customer:updated','customer:snapshot')) GROUP BY "inner_event"."body" ->> 'customer_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","customer_view","SELECT (\"event\".\"body\" ->> 'customer_id')::uuid AS \"customer_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'customer_id')::uuid AS \"customer_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('customer:created','customer:updated','customer:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'customer_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "merchant_view" AS SELECT ("event"."body" ->> 'merchant_id')::uuid AS "merchant_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'merchant_id')::uuid AS "merchant_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('merchant:created','merchant:updated','merchant:snapshot')) GROUP BY "inner_event"."body" ->> 'merchant_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","merchant_view","SELECT (\"event\".\"body\" ->> 'merchant_id')::uuid AS \"merchant_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'merchant_id')::uuid AS \"merchant_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('merchant:created','merchant:updated','merchant:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'merchant_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "moderator_view" AS SELECT ("event"."body" ->> 'moderator_id')::uuid AS "moderator_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'moderator_id')::uuid AS "moderator_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('moderator:created','moderator:updated','moderator:snapshot')) GROUP BY "inner_event"."body" ->> 'moderator_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","moderator_view","SELECT (\"event\".\"body\" ->> 'moderator_id')::uuid AS \"moderator_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'moderator_id')::uuid AS \"moderator_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('moderator:created','moderator:updated','moderator:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'moderator_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "user_view" AS SELECT ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'first_name')::varchar AS "first_name", ("event"."body" ->> 'last_name')::varchar AS "last_name", ("event"."body" ->> 'email')::varchar AS "email", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'user_id')::uuid AS "user_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('user:created','user:updated','user:snapshot')) GROUP BY "inner_event"."body" ->> 'user_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","user_view","SELECT (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'first_name')::varchar AS \"first_name\", (\"event\".\"body\" ->> 'last_name')::varchar AS \"last_name\", (\"event\".\"body\" ->> 'email')::varchar AS \"email\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('user:created','user:updated','user:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'user_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "offer_variant_price_view" AS SELECT ("event"."body" ->> 'offer_variant_id')::uuid AS "offer_variant_id", ("event"."body" ->> 'offer_variant_price_id')::uuid AS "offer_variant_price_id", ("event"."body" ->> 'token_id')::uuid AS "token_id", "event"."body" ->> 'amount' AS "amount", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'offer_variant_price_id')::uuid AS "offer_variant_price_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('offer:variant:price:created','offer:variant:price:updated','offer:variant:price:snapshot')) GROUP BY "inner_event"."body" ->> 'offer_variant_price_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","offer_variant_price_view","SELECT (\"event\".\"body\" ->> 'offer_variant_id')::uuid AS \"offer_variant_id\", (\"event\".\"body\" ->> 'offer_variant_price_id')::uuid AS \"offer_variant_price_id\", (\"event\".\"body\" ->> 'token_id')::uuid AS \"token_id\", \"event\".\"body\" ->> 'amount' AS \"amount\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'offer_variant_price_id')::uuid AS \"offer_variant_price_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('offer:variant:price:created','offer:variant:price:updated','offer:variant:price:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'offer_variant_price_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "offer_variant_view" AS SELECT ("event"."body" ->> 'offer_id')::uuid AS "offer_id", ("event"."body" ->> 'offer_variant_id')::uuid AS "offer_variant_id", "event"."body" ->> 'title' AS "title", "event"."body" ->> 'description' AS "description", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'offer_variant_id')::uuid AS "offer_variant_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('offer:variant:created','offer:variant:updated','offer:variant:snapshot')) GROUP BY "inner_event"."body" ->> 'offer_variant_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","offer_variant_view","SELECT (\"event\".\"body\" ->> 'offer_id')::uuid AS \"offer_id\", (\"event\".\"body\" ->> 'offer_variant_id')::uuid AS \"offer_variant_id\", \"event\".\"body\" ->> 'title' AS \"title\", \"event\".\"body\" ->> 'description' AS \"description\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'offer_variant_id')::uuid AS \"offer_variant_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('offer:variant:created','offer:variant:updated','offer:variant:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'offer_variant_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "complaint_view" AS SELECT ("event"."body" ->> 'complaint_id')::uuid AS "complaint_id", ("event"."body" ->> 'order_id')::uuid AS "order_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'decision')::jsonb AS "decision", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'complaint_id')::uuid AS "complaint_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('complaint:created','complaint:decision:refunded','complaint:decision:rejected','complaint:decision:released')) GROUP BY "inner_event"."body" ->> 'complaint_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","complaint_view","SELECT (\"event\".\"body\" ->> 'complaint_id')::uuid AS \"complaint_id\", (\"event\".\"body\" ->> 'order_id')::uuid AS \"order_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'decision')::jsonb AS \"decision\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'complaint_id')::uuid AS \"complaint_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('complaint:created','complaint:decision:refunded','complaint:decision:rejected','complaint:decision:released')) GROUP BY \"inner_event\".\"body\" ->> 'complaint_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "complaint_message_view" AS SELECT ("event"."body" ->> 'complaint_message_id')::uuid AS "complaint_message_id", ("event"."body" ->> 'complaint_id')::uuid AS "complaint_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'sent_at')::timestamp AS "sent_at", ("event"."body" ->> 'body') AS "body", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'complaint_message_id')::uuid AS "complaint_message_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('complaint:message:created')) GROUP BY "inner_event"."body" ->> 'complaint_message_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","complaint_message_view","SELECT (\"event\".\"body\" ->> 'complaint_message_id')::uuid AS \"complaint_message_id\", (\"event\".\"body\" ->> 'complaint_id')::uuid AS \"complaint_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'sent_at')::timestamp AS \"sent_at\", (\"event\".\"body\" ->> 'body') AS \"body\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'complaint_message_id')::uuid AS \"complaint_message_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('complaint:message:created')) GROUP BY \"inner_event\".\"body\" ->> 'complaint_message_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "user_wallet_view" AS SELECT ("event"."body" ->> 'user_wallet_id')::uuid AS "user_wallet_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'chain')::varchar AS "chain", ("event"."body" ->> 'address')::varchar AS "address", ("event"."body" ->> 'type')::varchar AS "type", ("event"."body" ->> 'sub_organization_id')::varchar AS "sub_organization_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'user_wallet_id')::uuid AS "user_wallet_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('user:wallet:created')) GROUP BY "inner_event"."body" ->> 'user_wallet_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","user_wallet_view","SELECT (\"event\".\"body\" ->> 'user_wallet_id')::uuid AS \"user_wallet_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'chain')::varchar AS \"chain\", (\"event\".\"body\" ->> 'address')::varchar AS \"address\", (\"event\".\"body\" ->> 'type')::varchar AS \"type\", (\"event\".\"body\" ->> 'sub_organization_id')::varchar AS \"sub_organization_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'user_wallet_id')::uuid AS \"user_wallet_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('user:wallet:created')) GROUP BY \"inner_event\".\"body\" ->> 'user_wallet_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "token_view" AS SELECT ("event"."body" ->> 'token_id')::uuid AS "token_id", ("event"."body" ->> 'token_address')::varchar AS "token_address", ("event"."body" ->> 'icon_url')::varchar AS "icon_url", ("event"."body" ->> 'symbol')::varchar AS "symbol", ("event"."body" ->> 'precision')::int AS "precision", ("event"."body" ->> 'name')::varchar AS "name", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'token_id')::uuid AS "token_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('token:created','token:updated','token:snapshot')) GROUP BY "inner_event"."body" ->> 'token_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","token_view","SELECT (\"event\".\"body\" ->> 'token_id')::uuid AS \"token_id\", (\"event\".\"body\" ->> 'token_address')::varchar AS \"token_address\", (\"event\".\"body\" ->> 'icon_url')::varchar AS \"icon_url\", (\"event\".\"body\" ->> 'symbol')::varchar AS \"symbol\", (\"event\".\"body\" ->> 'precision')::int AS \"precision\", (\"event\".\"body\" ->> 'name')::varchar AS \"name\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'token_id')::uuid AS \"token_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('token:created','token:updated','token:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'token_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "order_view" AS SELECT ("event"."body" ->> 'order_id')::uuid AS "order_id", ("event"."body" ->> 'offer_variant_id')::uuid AS "offer_variant_id", ("event"."body" ->> 'offer_variant_price_id')::uuid AS "offer_variant_price_id", ("event"."body" ->> 'quantity') AS "quantity", ("event"."body" ->> 'contract_id')::uuid AS "contract_id", ("event"."body" ->> 'merchant_id')::uuid AS "merchant_id", ("event"."body" ->> 'customer_id')::uuid AS "customer_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'order_id')::uuid AS "order_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('order:created','order:snapshot')) GROUP BY "inner_event"."body" ->> 'order_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","order_view","SELECT (\"event\".\"body\" ->> 'order_id')::uuid AS \"order_id\", (\"event\".\"body\" ->> 'offer_variant_id')::uuid AS \"offer_variant_id\", (\"event\".\"body\" ->> 'offer_variant_price_id')::uuid AS \"offer_variant_price_id\", (\"event\".\"body\" ->> 'quantity') AS \"quantity\", (\"event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", (\"event\".\"body\" ->> 'merchant_id')::uuid AS \"merchant_id\", (\"event\".\"body\" ->> 'customer_id')::uuid AS \"customer_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'order_id')::uuid AS \"order_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('order:created','order:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'order_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "offer_view" AS SELECT ("event"."body" ->> 'offer_id')::uuid AS "offer_id", ("event"."body" ->> 'title') AS "title", ("event"."body" ->> 'description') AS "description", ("event"."body" ->> 'merchant_id')::uuid AS "merchant_id", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'offer_id')::uuid AS "offer_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('offer:created','offer:updated','offer:snapshot')) GROUP BY "inner_event"."body" ->> 'offer_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","offer_view","SELECT (\"event\".\"body\" ->> 'offer_id')::uuid AS \"offer_id\", (\"event\".\"body\" ->> 'title') AS \"title\", (\"event\".\"body\" ->> 'description') AS \"description\", (\"event\".\"body\" ->> 'merchant_id')::uuid AS \"merchant_id\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'offer_id')::uuid AS \"offer_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('offer:created','offer:updated','offer:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'offer_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "contract_deployment_view" AS SELECT ("event"."body" ->> 'contract_id')::uuid AS "contract_id", ("event"."body" ->> 'deployment')::jsonb ->> 'transaction_hash' AS "transaction_hash", ("event"."body" ->> 'deployment')::jsonb ->> 'error' AS "error_message", ("event"."body" ->> 'deployment')::jsonb ->> 'address' AS "address", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'contract_id')::uuid AS "contract_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('contract:deployment:started','contract:deployment:failed','contract:deployment:completed')) GROUP BY "inner_event"."body" ->> 'contract_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","contract_deployment_view","SELECT (\"event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", (\"event\".\"body\" ->> 'deployment')::jsonb ->> 'transaction_hash' AS \"transaction_hash\", (\"event\".\"body\" ->> 'deployment')::jsonb ->> 'error' AS \"error_message\", (\"event\".\"body\" ->> 'deployment')::jsonb ->> 'address' AS \"address\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('contract:deployment:started','contract:deployment:failed','contract:deployment:completed')) GROUP BY \"inner_event\".\"body\" ->> 'contract_id') \"event\""]);
        await queryRunner.query(`CREATE VIEW "contract_view" AS SELECT ("event"."body" ->> 'contract_id')::uuid AS "contract_id", "contract_deployment"."address" AS "contract_address", "contract_deployment"."transaction_hash" AS "deployment_transaction_hash", "contract_deployment"."created_at" AS "deployed_at", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'contract_id')::uuid AS "contract_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('contract:created')) GROUP BY "inner_event"."body" ->> 'contract_id') "event" LEFT JOIN (SELECT * FROM "contract_deployment_view" "deployment" ORDER BY "deployment"."created_at" DESC) "contract_deployment" ON "contract_deployment"."contract_id" = ("event"."body" ->> 'contract_id')::uuid`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","contract_view","SELECT (\"event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", \"contract_deployment\".\"address\" AS \"contract_address\", \"contract_deployment\".\"transaction_hash\" AS \"deployment_transaction_hash\", \"contract_deployment\".\"created_at\" AS \"deployed_at\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'contract_id')::uuid AS \"contract_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('contract:created')) GROUP BY \"inner_event\".\"body\" ->> 'contract_id') \"event\" LEFT JOIN (SELECT * FROM \"contract_deployment_view\" \"deployment\" ORDER BY \"deployment\".\"created_at\" DESC) \"contract_deployment\" ON \"contract_deployment\".\"contract_id\" = (\"event\".\"body\" ->> 'contract_id')::uuid"]);
        await queryRunner.query(`CREATE VIEW "user_credential_view" AS SELECT ("event"."body" ->> 'user_credential_id')::uuid AS "user_credential_id", ("event"."body" ->> 'user_id')::uuid AS "user_id", ("event"."body" ->> 'type')::varchar AS "type", ("event"."body" ->> 'hash')::varchar AS "hash", ("event"."body" ->> 'salt')::varchar AS "salt", "event"."created_at" AS "created_at" FROM (SELECT ("inner_event"."body" ->> 'user_credential_id')::uuid AS "user_credential_id", jsonb_recursive_mergeagg("inner_event"."body") AS "body", MIN("inner_event"."created_at") AS "created_at" FROM "events" "inner_event" WHERE ("inner_event"."type" IN ('user:credential:created','user:credential:snapshot')) GROUP BY "inner_event"."body" ->> 'user_credential_id') "event"`);
        await queryRunner.query(`INSERT INTO "typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["public","VIEW","user_credential_view","SELECT (\"event\".\"body\" ->> 'user_credential_id')::uuid AS \"user_credential_id\", (\"event\".\"body\" ->> 'user_id')::uuid AS \"user_id\", (\"event\".\"body\" ->> 'type')::varchar AS \"type\", (\"event\".\"body\" ->> 'hash')::varchar AS \"hash\", (\"event\".\"body\" ->> 'salt')::varchar AS \"salt\", \"event\".\"created_at\" AS \"created_at\" FROM (SELECT (\"inner_event\".\"body\" ->> 'user_credential_id')::uuid AS \"user_credential_id\", jsonb_recursive_mergeagg(\"inner_event\".\"body\") AS \"body\", MIN(\"inner_event\".\"created_at\") AS \"created_at\" FROM \"events\" \"inner_event\" WHERE (\"inner_event\".\"type\" IN ('user:credential:created','user:credential:snapshot')) GROUP BY \"inner_event\".\"body\" ->> 'user_credential_id') \"event\""]);
    }

}
